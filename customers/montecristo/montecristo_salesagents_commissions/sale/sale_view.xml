<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
		
        <!-- TREE -->
        <record id="montecristo_salesagent_view_quotation_tree" model="ir.ui.view">
            <field name="name">montecristo.salesagent.view.quotation.tree</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_quotation_tree"/>
             <field name="arch" type="xml">                                              
                <xpath expr='//field[@name="state"]' position="before">
					<field name="confirmed"/>
                </xpath>
                <xpath expr="//field[@name='user_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>                     
                <xpath expr="//field[@name='user_id']" position="after">
                    <field name="salesagent_id" />
                </xpath>                                
             </field>
        </record>          
        
        <record id="montecristo_salesagent_view_order_tree" model="ir.ui.view">
            <field name="name">montecristo.salesagent.view.order.tree</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
             <field name="arch" type="xml">                                              
                <xpath expr="//field[@name='user_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>                     
                <xpath expr="//field[@name='user_id']" position="after">
                    <field name="salesagent_id" />
                </xpath>                                
             </field>
        </record>           
        
        <!--  FORM -->
        <record id="montecristo_salesagent_view_order_form" model="ir.ui.view">
            <field name="name">montecristo.salesagent.view.order.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
             <field name="arch" type="xml">
                <xpath expr='//field[@name="partner_id"]' position="before">
                    <field name="confirmed" attrs="{'invisible':[('state','not in',['draft','sent'])], 'readonly':['|',('state','not in',['draft','sent']),('salesagent','=',True)]}"/>
                </xpath>
                <xpath expr='//field[@name="order_line"]/form/group/group/field[@name="price_unit"]' position="before">
                    <field name="salesagent" invisible="1"/>
                </xpath>
                <xpath expr='//field[@name="order_line"]/tree/field[@name="price_unit"]' position="before">
                    <field name="salesagent" invisible="1"/>
                </xpath>                
                <xpath expr='//field[@name="order_line"]/form/group/group/field[@name="price_unit"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('state','not in',['draft','sent']),('salesagent','=',True)], 'required':False}</attribute>
                </xpath>
                <xpath expr='//field[@name="order_line"]/tree/field[@name="price_unit"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('state','not in',['draft','sent']),('salesagent','=',True)], 'required':False}</attribute>
                </xpath>
                <xpath expr='//field[@name="order_line"]/form/group/group/field[@name="tax_id"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('state','not in',['draft','sent']),('salesagent','=',True)], 'required':False}</attribute>
                </xpath>
                <xpath expr='//field[@name="order_line"]/tree/field[@name="tax_id"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('state','not in',['draft','sent']),('salesagent','=',True)], 'required':False}</attribute>
                </xpath>                

                <xpath expr='//field[@name="name"]' position="before">
                    <field name="salesagent" invisible="1"/>
                </xpath>                
                <xpath expr='//button[@string="Confirm Sale" and @states="draft"]' position="attributes">
					<attribute name="attrs">{'invisible':['|',('salesagent','=',True)]}</attribute>
                </xpath>
                <xpath expr='//button[@string="Confirm Sale" and @states="sent"]' position="attributes">
					<attribute name="attrs">{'invisible':['|',('salesagent','=',True)]}</attribute>
                </xpath>                                
                <xpath expr='//button[@string="Create Invoice"]' position="attributes">
					<attribute name="attrs">{'invisible':['|',('salesagent','=',True)]}</attribute>
                </xpath> 
                <xpath expr='//button[@name="action_view_invoice"]' position="attributes">
					<attribute name="attrs">{'invisible':['|',('salesagent','=',True),('invoice_exists','=',False)]}</attribute>
                </xpath>
                <xpath expr='//field[@name="pricelist_id"]' position="attributes">
					<attribute name="attrs">{'invisible':[('salesagent','=',True)]}</attribute>                    
                </xpath>
                <xpath expr='//field[@name="client_order_ref"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>                    
                </xpath>   
                <xpath expr='//field[@name="payment_term"]' position="attributes">
					<attribute name="attrs">{'readonly':[('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>                    
                </xpath> 
                <xpath expr='//field[@name="fiscal_position"]' position="attributes">
					<attribute name="attrs">{'readonly':[('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>                    
                </xpath>
                <xpath expr='//field[@name="user_id"]' position="attributes">
					<attribute name="attrs">{'readonly':[('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>                    
                </xpath>
                <xpath expr='//field[@name="note"]' position="attributes">
					<attribute name="attrs">{'readonly':[('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>                    
                </xpath>                                                                                                                                                                                                                                                                                 
             </field>
        </record>         
        
        <record id="montecristo_salesagent_view_order_form_inherit" model="ir.ui.view">
            <field name="name">montecristo.salesagent.view.order.form.inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_stock.view_order_form_inherit"/>
             <field name="arch" type="xml">                                              
                <xpath expr='//button[@name="action_view_delivery"]' position="attributes">
					<attribute name="attrs">{'invisible':['|','|',('salesagent','=',True),('picking_ids','=',False),('picking_ids','=',[])]}</attribute>
                </xpath>    
                <xpath expr='//field[@name="order_policy"]' position='attributes'>
                    <attribute name="attrs">{'readonly':[('salesagent','=',True)]}</attribute>
                </xpath>   
                <xpath expr='//field[@name="picking_policy"]' position='attributes'>
                    <attribute name="attrs">{'readonly':[('salesagent','=',True)]}</attribute>
                </xpath> 
                <xpath expr='//field[@name="incoterm"]' position='attributes'>
                    <attribute name="attrs">{'invisible':[('salesagent','=',True)], 'readonly':[('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>
                </xpath>                                                  
             </field>
        </record>         

        <record id="montecristo_salesagent_view_order_form2" model="ir.ui.view">
            <field name="name">montecristo.salesagent.view.order.form2</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_custom_montecristo.montecristo_view_order_form"/>
             <field name="arch" type="xml">                                              
                <xpath expr='//field[@name="season"]' position="attributes">
					<attribute name="attrs">{'readonly':[('salesagent','=',True)]}</attribute>
                </xpath>
                <xpath expr='//field[@name="delivery_date"]' position="attributes">
					<attribute name="attrs">{'readonly':[('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>
                </xpath>                                       
             </field>
        </record>
        
        <record id="montecristo_salesagent_view_order_form_montecristo_grid" model="ir.ui.view">
            <field name="name">montecristo.salesagent.view.order.form2</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_custom_montecristo.view_order_form_montecristo_grid"/>
             <field name="arch" type="xml">                                              
                <xpath expr='//page[@string="Gestione degli Sconti"]' position="attributes">
					<attribute name="attrs">{'invisible':[('salesagent','=',True)]}</attribute> 
				</xpath>                                     
             </field>
        </record>         
        
        <record id="montecristo_view_sale_salesagent_commissions_form" model="ir.ui.view">
            <field name="name">montecristo.sale.salesagent.commissions.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_salesagent_commissions.view_sale_salesagent_commissions_form"/>
             <field name="arch" type="xml">                                              
                <xpath expr='//field[@name="salesagent_id"]' position="attributes">
					<attribute name="attrs">{'invisible':[('salesagent','=',True)]}</attribute>
                </xpath>                                       
             </field>
        </record> 
        
        <record id="montecristo_view_sale_journal_form" model="ir.ui.view">
            <field name="name">montecristo.sale.journal.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_journal.sale_journal_sale_order"/>
             <field name="arch" type="xml">                                              
                <xpath expr='//field[@name="invoice_type_id"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>
                </xpath>                                       
             </field>
        </record>      

        <record id="montecristo_view_sale_delivery_makeover_form" model="ir.ui.view">
            <field name="name">montecristo.sale.delivery_makeover.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="l10n_it_ddt.sale_order_form_view_ddt"/>
             <field name="arch" type="xml">
                <xpath expr='//page[@string="Shipping Informations"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>
                </xpath> 
             </field>
        </record>

        <record id="montecristo_view_sale_delivery_withcarrier_form" model="ir.ui.view">
            <field name="name">montecristo.sale.delivery.withcarrier.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="delivery.view_order_withcarrier_form"/>
             <field name="arch" type="xml">
                <xpath expr='//field[@name="carrier_id"]' position="attributes">
                    <attribute name="attrs">{'readonly':['|',('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>
                </xpath>
                <xpath expr='//label[@for="carrier_id"]' position="attributes">
                    <attribute name="attrs">{'readonly':['|',('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>
                </xpath>
             </field>
        </record>

        <record id="montecristo_view_sale_salesagent_commissions_form_crm" model="ir.ui.view">
            <field name="name">montecristo.sale.salesagent.commissions.form.crm</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_crm.sale_view_inherit123"/>
             <field name="arch" type="xml">                                              
                <xpath expr='//field[@name="categ_ids"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>
                </xpath>   
                <xpath expr='//field[@name="campaign_id"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>
                </xpath>
                <xpath expr='//field[@name="medium_id"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>
                </xpath>
                <xpath expr='//field[@name="source_id"]' position="attributes">
					<attribute name="attrs">{'readonly':['|',('salesagent','=',True),('state','not in',['draft','sent'])]}</attribute>
                </xpath>                                                                                       
             </field>
        </record>        
         
	    <record id="montecristo_view_order_form_discount" model="ir.ui.view">
	        <field name="name">montecristo.sale.order.discount.view</field>
	        <field name="model">sale.order</field>
	        <field name="inherit_id" ref="account_discount.view_order_form_discount"/>
	        <field name="arch" type="xml">
	            <xpath expr="//tree[@string='Sconti globali']/field[@name='type']" position="attributes" >
	            	<attribute name="invisible">1</attribute>
	            </xpath> 								
	        </field>
	    </record>        

        <record id="view_order_makeover_form_salesagent" model="ir.ui.view">
            <field name="name">sale.order.makeover.salesagent.view</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_makeover.view_order_makeover_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='document_type_id']" position="attributes">
					<attribute name="attrs">{'invisible':[('salesagent','=',True)]}</attribute>
				</xpath>
				<xpath expr="//field[@name='to_customer']" position="attributes">
					<attribute name="attrs">{'invisible':[('salesagent','=',True)]}</attribute>
                </xpath>
				<xpath expr="//field[@name='to_supplier']" position="attributes">
					<attribute name="attrs">{'invisible':[('salesagent','=',True)]}</attribute>
                </xpath>                             
            </field>
        </record>	    
	    
        <!-- RICERCA -->

	    <record id="montecristo_salesagent_view_sales_order_filter" model="ir.ui.view">
	        <field name="name">montecristo.salesagent.view.sales.order.filter</field>
	        <field name="model">sale.order</field>
	        <field name="inherit_id" ref="sale.view_sales_order_filter"/>
	        <field name="arch" type="xml">
	            <xpath expr="//filter[@string='My']" position="after" >
					<filter string="Approved" domain="[('confirmed','=',True)]" name="approved"/>
					<filter string="Not Approved" domain="[('confirmed','=',False)]" name="not_approved"/>
				</xpath>
				<xpath expr="//field[@name='user_id']" position="replace">
				    <field name="salesagent_id"/>
				</xpath>						
				<xpath expr="//filter[@string='Salesperson']" position="replace">
				    <filter string="Salesagent" domain="[]" context="{'group_by': 'salesagent_id' }" />
				    <filter string="Season" domain="[]" context="{'group_by':'season'}" />
				</xpath>										
	        </field>
	    </record>           
        
        <!-- MENU -->
        
        <menuitem id="account.menu_finance_reporting" 
            name="Accounting" 
            parent="base.menu_reporting" 
            sequence="35" 
            groups="account.group_account_user"/>
        
        
    </data>
</openerp>
