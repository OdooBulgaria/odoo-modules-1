<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        
        <record id="montecristo_view_order_form" model="ir.ui.view">
            <field name="name">montecristo.view.order.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
             <field name="arch" type="xml">
                <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="on_change">onchange_partner_id(partner_id,season,salesagent_id,context)</attribute>
                </xpath>           
                <xpath expr='//button[@name="print_quotation"]' position="before">
                    <button name="print_quotation_preview" string="Anteprima" type="object" states="draft,sent,progress,manual" groups="base.group_user"/>
                </xpath>
                <xpath expr='//field[@name="invoiced"]' position="before">
					<field name="date_expected_payment" attrs="{'readonly':[('salesagent','=',True),('state','not in','draft')]}"/>               																																		
                </xpath>
                <xpath expr='//field[@name="payment_term"]' position="attributes">
                    <attribute name="required">1</attribute>
                </xpath>
                <xpath expr='//field[@name="project_id"]' position="after">
                    <field name="season" required="1" options="{'no_create': True}" on_change="onchange_season_salesagent_id(partner_id,season,salesagent_id)"/>
                    <!-- <field name="multi_season" invisible="1"/> -->
                    <field name="delivery_date" required="1"/>
                    <field name="date_start_payment"/>
                    <group string="Stagione precedente:">
	                    <field name="historical_amount" readonly="1"/>
	                    <field name="historical_pieces" readonly="1"/>
                    </group>
                </xpath>
                <xpath expr='//group[@class="oe_subtotal_footer oe_right"]/field[@name="amount_untaxed"]' position="before">
                    <field name="total_qty"/>
                </xpath>
                <xpath expr="//field[@name='partner_invoice_id']" position="attributes">
                    <attribute name="domain">[('type','in',['contact','invoice']),'|',('child_ids','in',partner_id),('id','child_of',partner_id)]</attribute>
                </xpath>    
                <xpath expr="//field[@name='partner_shipping_id']" position="attributes">
                    <attribute name="domain">[('type','in',['contact','delivery']),'|',('child_ids','in',partner_id),('id','child_of',partner_id)]</attribute>
                </xpath>                                                                     
             </field>
        </record>

        <record id="montecristo_view_sale_salesagent_commissions_form" model="ir.ui.view">
            <field name="name">montecristo.view.sale.salesagent.commissions.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_salesagent_commissions.view_sale_salesagent_commissions_form"/>
             <field name="arch" type="xml">
                <xpath expr="//field[@name='salesagent_id']" position="attributes">
                    <attribute name="on_change">onchange_season_salesagent_id(partner_id,season,salesagent_id)</attribute>
                </xpath>       
             </field>
        </record>        

        <record id="montecristo_sale_journal_sale_order_tree" model="ir.ui.view">
            <field name="name">montecristo.sale.journal.sale.order.tree</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_journal.sale_journal_sale_order_tree"/>
             <field name="arch" type="xml">
                <xpath expr="//field[@name='invoice_type_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>       
             </field>
        </record>         
        
        <record id="montecristo_view_order_form_inherit" model="ir.ui.view">
            <field name="name">montecristo.view.order.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_stock.view_order_form_inherit"/>
             <field name="arch" type="xml">
                <xpath expr='//field[@name="incoterm"]' position="attributes">
                    <attribute name="required">1</attribute>
                </xpath>           
             </field>
        </record>
        
        <record id="view_order_form_montecristo_grid" model="ir.ui.view">
            <field name="name">view.order.form.montecristo.grid</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="grid_custom_montecristo.view_order_form_montecristo"/>
             <field name="arch" type="xml">
                <xpath expr='//field[@name="template_id"]' position="attributes">
                    <!-- AGGIUNGERE QUESTA RIGA AL DOMINIO SEGUENTE: '|',('active','=',multi_season),-->
                    <attribute name="domain">[('produzione','=',season),('attr_count','in',[1,2])]</attribute>
                </xpath>
                <xpath expr="//page[@string='Grid']" position="after">
                    <page string="Gestione delle Consegne">
                        <button string="Genera Date di Consegna" name="load_categories_dates" type="object" icon="gtk-ok"  colspan="4"/>
	                    <field name="date_per_category_ids">
	                        <tree string="Date di consegna per categorie" editable="bottom">
	                            <field name="category_id"/>
	                            <field name="delivery_date"/>
	                        </tree>
	                    </field>
                        <button string="Aggiorna Date di Consegna" name="set_delivery_dates" type="object" icon="gtk-ok"  colspan="4"/>	                    
	                </page>
                    <page string="Gestione degli Sconti" groups="sale.group_discount_per_so_line">
                        <button string="Genera Sconti" name="load_template_discounts" type="object" icon="gtk-ok"  colspan="4"/>
	                    <field name="discount_per_template_ids">
	                        <tree string="Sconti per modello prodotto" editable="bottom">
	                            <field name="template_id"/>
	                            <field name="discount"/>
	                        </tree>
	                    </field>
                        <button string="Aggiorna Sconti" name="set_discounts" type="object" icon="gtk-ok"  colspan="4"/>	                    
	                </page>	                    
                </xpath>       
             </field>
        </record>           

	    <record id="view_order_tree_payment" model="ir.ui.view">
	        <field name="name">view.order.tree.payment</field>
	        <field name="model">sale.order</field>
	        <field name="inherit_id" ref="sale.view_order_tree"/>
	        <field name="arch" type="xml">												
				<xpath expr="//field[@name='name']" position="after">
				    <field name="payment_term"/>
				</xpath>			
	        </field>
	    </record>  	    

	    <record id="view_quotation_tree_payment" model="ir.ui.view">
	        <field name="name">view.quotation.tree.payment</field>
	        <field name="model">sale.order</field>
	        <field name="inherit_id" ref="sale.view_quotation_tree"/>
	        <field name="arch" type="xml">												
				<xpath expr="//field[@name='name']" position="after">
				    <field name="payment_term"/>
				</xpath>			
	        </field>
	    </record>          
        
        <!-- 
        <record id="view_order_type_document_montecristo" model="ir.ui.view">
            <field name="name">sale.order.type.document.montecristo</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_makeover.view_order_makeover_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='document_type_id']" position="attributes">
                    <attribute name="on_change">onchange_document_type_id(document_type_id)</attribute>
                </xpath>
            </field>
        </record>
        
        -->
        <!-- Tipo Documento -->
		<!-- 
        <record id="sale_document_type_form_montecristo" model="ir.ui.view">
            <field name="name">sale.document.type.form.montecristo</field>
            <field name="model">sale.document.type</field>
            <field name="inherit_id" ref="sale_makeover.sale_document_type_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='sequence_id']" position="after">
                    <field name="multi_season"/>
                </xpath>
            </field>
        </record>                
        -->
        <!-- Actions -->
        
        <record id="action_quotations" model="ir.actions.act_window">
            <field name="name">Proposte d'ordine</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="sale.view_quotation_tree"/>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="context">{}</field>
            <field name="domain">[('state','in',('draft','sent','cancel'))]</field>
            <field name="search_view_id" ref="sale.view_sales_order_filter"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a quotation, the first step of a new sale.
              </p><p>
                Odoo will help you handle efficiently the complete sale flow:
                from the quotation to the sales order, the
                delivery, the invoicing and the payment collection.
              </p><p>
                The social feature helps you organize discussions on each sales
                order, and allow your customers to keep track of the evolution
                of the sales order.
              </p>
            </field>
        </record>        

        <record id="action_orders" model="ir.actions.act_window">
            <field name="name">Sales Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="search_view_id" ref="sale.view_sales_order_filter"/>
            <field name="context">{}
            </field>
            <field name="domain">[('state', 'not in', ('draft', 'sent', 'cancel'))]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to create a quotation that can be converted into a sales
                    order.
                </p><p>
                    Odoo will help you efficiently handle the complete sales flow:
                    quotation, sales order, delivery, invoicing and payment.
                </p>
            </field>
        </record>

  		<record id="view_order_line_delivery_montecristo_form" model="ir.ui.view">
            <field name="name">sale.order.line.makeover.montecristo.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="l10n_it_ddt_makeover.view_order_line_delivery_makeover_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='order_line']" position="attributes">
                       <attribute name="context">{'default_delivery_date': None} </attribute>
                 </xpath>
           </field>
        </record>

        <!-- Menù -->
        
        <menuitem id="sale.menu_sale_quotations"
                action="action_quotations" parent="base.menu_sales"
                sequence="5"/>        
             
    </data>
</openerp>
